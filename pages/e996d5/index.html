<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>油猴 | SRのブログ</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="SR的博客">
    <link rel="preload" href="/my-doc/assets/css/0.styles.36f9a762.css" as="style"><link rel="preload" href="/my-doc/assets/js/app.029ead00.js" as="script"><link rel="preload" href="/my-doc/assets/js/2.5123b685.js" as="script"><link rel="preload" href="/my-doc/assets/js/17.0a47cbea.js" as="script"><link rel="prefetch" href="/my-doc/assets/js/10.5a5b3da1.js"><link rel="prefetch" href="/my-doc/assets/js/11.05509dc7.js"><link rel="prefetch" href="/my-doc/assets/js/12.05cf279f.js"><link rel="prefetch" href="/my-doc/assets/js/13.40da6894.js"><link rel="prefetch" href="/my-doc/assets/js/14.af6691c5.js"><link rel="prefetch" href="/my-doc/assets/js/15.be3f8228.js"><link rel="prefetch" href="/my-doc/assets/js/16.ffefacb6.js"><link rel="prefetch" href="/my-doc/assets/js/18.690b5bcd.js"><link rel="prefetch" href="/my-doc/assets/js/19.9dda1ef6.js"><link rel="prefetch" href="/my-doc/assets/js/3.04fef1ce.js"><link rel="prefetch" href="/my-doc/assets/js/4.7b288bed.js"><link rel="prefetch" href="/my-doc/assets/js/5.a573b3d1.js"><link rel="prefetch" href="/my-doc/assets/js/6.d2e40ee7.js"><link rel="prefetch" href="/my-doc/assets/js/7.be059298.js"><link rel="prefetch" href="/my-doc/assets/js/8.2138bb4d.js"><link rel="prefetch" href="/my-doc/assets/js/9.0fa8f3b8.js">
    <link rel="stylesheet" href="/my-doc/assets/css/0.styles.36f9a762.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-doc/" class="home-link router-link-active"><!----> <span class="site-name">SRのブログ</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-doc/" class="nav-link">主页</a></div><div class="nav-item"><a href="/my-doc/知识碎片/油猴.html" class="nav-link">知识碎片</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Bootstrap" class="dropdown-title"><!----> <span class="title" style="display:;">Bootstrap</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-doc/Bootstrap/插件/折叠Collapse.html" class="nav-link">Bootstrap插件</a></li><li class="dropdown-item"><!----> <a href="/my-doc/Bootstrap/基础样式/test.html" class="nav-link">Bootstrap基础样式</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/my-doc/" class="nav-link">主页</a></div><div class="nav-item"><a href="/my-doc/知识碎片/油猴.html" class="nav-link">知识碎片</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Bootstrap" class="dropdown-title"><!----> <span class="title" style="display:;">Bootstrap</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-doc/Bootstrap/插件/折叠Collapse.html" class="nav-link">Bootstrap插件</a></li><li class="dropdown-item"><!----> <a href="/my-doc/Bootstrap/基础样式/test.html" class="nav-link">Bootstrap基础样式</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>知识碎片</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/my-doc/pages/e996d5/" aria-current="page" class="active sidebar-link">1.油猴</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#头部" class="sidebar-link">头部</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#include" class="sidebar-link">@include</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#exclude" class="sidebar-link">@exclude</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#require" class="sidebar-link">@require</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#resource" class="sidebar-link">@resource</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#connect" class="sidebar-link">@connect</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#run-at" class="sidebar-link">@run-at</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#grant" class="sidebar-link">@grant</a></li></ul></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#逻辑层" class="sidebar-link">逻辑层</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#unsafewindow" class="sidebar-link">unsafeWindow</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#subresource-integrity" class="sidebar-link">Subresource Integrity</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#gm-addstyle-gm-getresourcetext" class="sidebar-link">GMaddStyle &amp; GMgetResourceText</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#gm-getresourcetext-name" class="sidebar-link">GM_getResourceText(name)</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#gm-addelement" class="sidebar-link">GM_addElement</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#gm-set-get-deletevalue-gm-listvalues" class="sidebar-link">GMset/get/deleteValue &amp; GMlistValues</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#gm-add-removevaluechangelistener" class="sidebar-link">GM_add/removeValueChangeListener</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#gm-log-message" class="sidebar-link">GM_log(message)</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#gm-reg-unregistermenucommand" class="sidebar-link">GM_reg/unregisterMenuCommand</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#gm-openintab-url-options-gm-openintab-url-loadinbackground" class="sidebar-link">GMopenInTab(url, options), GMopenInTab(url, loadInBackground)</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#gm-xmlhttprequest-details" class="sidebar-link">GM_xmlhttpRequest(details)</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#gm-gettab-callback" class="sidebar-link">GM_getTab(callback)</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#gm-savetab-tab" class="sidebar-link">GM_saveTab(tab)</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#gm-gettabs-callback" class="sidebar-link">GM_getTabs(callback)</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#gm-notification-gm-openintab-gm-setclipboard" class="sidebar-link">GMnotification &amp; GMopenInTab &amp; GM_setClipboard</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#gm-notification-details-ondone-gm-notification-text-title-image-onclick" class="sidebar-link">GMnotification(details, ondone), GMnotification(text, title, image, onclick)</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#gm-setclipboard-data-info" class="sidebar-link">GM_setClipboard(data, info)</a></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#gm-info" class="sidebar-link">GM_info</a></li></ul></li><li class="sidebar-sub-header"><a href="/my-doc/pages/e996d5/#例子" class="sidebar-link">例子</a></li></ul></li><li><a href="/my-doc/pages/5e622c/" class="sidebar-link">2.使用postman</a></li><li><a href="/my-doc/pages/8fbf8e/" class="sidebar-link">3.npm的多脚本命令执行</a></li><li><a href="/my-doc/pages/59b116/" class="sidebar-link">3.彻底卸载vscode</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/my-doc/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/my-doc/categories/?category=%E7%9F%A5%E8%AF%86%E7%A2%8E%E7%89%87" title="分类" data-v-1cd794fe>知识碎片</a></li> <!----> <!----></ul> <div class="info" data-v-1cd794fe><!----> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2022-06-18</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          油猴
        </h1> <!----> <div class="theme-vdoing-content content__default"><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// ==UserScript==</span>
<span class="token comment">// @name         New Userscript</span>
<span class="token comment">// @namespace    http://tampermonkey.net/</span>
<span class="token comment">// @version      0.1</span>
<span class="token comment">// @description  try to take over the world!</span>
<span class="token comment">// @author       You</span>
<span class="token comment">// @match        http://*/*</span>
<span class="token comment">// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</span>
<span class="token comment">// @grant        none</span>
<span class="token comment">// ==/UserScript==</span>

<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token string">'use strict'</span><span class="token punctuation">;</span>
    <span class="token comment">// Your code here...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>油猴脚本由头部和核心逻辑两部分组成</p> <h2 id="头部"><a href="#头部" class="header-anchor">#</a> 头部</h2> <ul><li>@name脚本的名称</li> <li>@namespace脚本的命名空间</li> <li>@version脚本当前版本与更新相关</li> <li>@author作者</li> <li>@description简短介绍</li> <li>@homepage, @homepageURL, @website and @source//主页地址</li> <li>@icon, @iconURL and @defaulticon脚本 icon</li> <li>@icon64 and @icon64URL 64x64像素的脚本 icon</li> <li>@updateURL检查脚本是否更新地址(配合 @version 和自动更新使用)</li> <li>@downloadURL检测到更新时，去哪下载脚本</li> <li>@supportURL遇到问题时，用户去哪反馈</li></ul> <h3 id="include"><a href="#include" class="header-anchor">#</a> @include</h3> <p>脚本在哪些页面运行,可使用正则，不支持 hashtag，多个页面的地址声明多个 @include 即可
@match与 @include 类似</p> <h3 id="exclude"><a href="#exclude" class="header-anchor">#</a> @exclude</h3> <p>脚本禁止在哪些页面运行，优先于 @include</p> <h3 id="require"><a href="#require" class="header-anchor">#</a> @require</h3> <p>在脚本运行前引入外部 JavaScript 文件	例如，引入 jQuery</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/* globals jQuery, $, waitForKeyElements */</span><span class="token punctuation">(</span>引入jquery报警告，在最前面加个注释<span class="token punctuation">)</span>
<span class="token comment">/* globals jQuery, $, waitForKeyElements */</span>
<span class="token comment">// ==UserScript==</span>
<span class="token comment">// @name         New Userscript</span>
<span class="token comment">// @namespace    http://tampermonkey.net/</span>
<span class="token comment">// @version      0.1</span>
<span class="token comment">// @description  try to take over the world!</span>
<span class="token comment">// @author       You</span>
<span class="token comment">// @include      http://*</span>
<span class="token comment">// @include      https://*</span>
<span class="token comment">// @icon         https://www.google.com/s2/favicons?sz=64&amp;domain=tampermonkey.net</span>
<span class="token comment">// @grant        GM_download</span>
<span class="token comment">// @run-at       document-idle</span>
<span class="token comment">// @require      https://www.unpkg.com/jquery@3.5.1/dist/jquery.slim.min.js</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="resource"><a href="#resource" class="header-anchor">#</a> @resource</h3> <p>声明外部资源文件，搭配 GM_getResourceText 使用	例如引入 html、icon</p> <h3 id="connect"><a href="#connect" class="header-anchor">#</a> @connect</h3> <p>声明 GM_xmlhttpRequest 可访问的域	必须指定才能正常请求</p> <ul><li>像 tampermonkey.net 这样的域（这也将允许所有子域）</li> <li>self ，将脚本当前正在运行的域列入白名单</li> <li>localhost ，访问本地主机</li> <li>1.2.3.4 连接一个IP地址</li> <li><ul><li></li></ul></li></ul> <h3 id="run-at"><a href="#run-at" class="header-anchor">#</a> @run-at</h3> <p>指定脚本运行时机</p> <ul><li>document-start: 尽快执行</li> <li>document-body: 当 body 挂载时执行</li> <li>document-end: DOMContentLoaded 触发时执行</li> <li>document-idle: DOMContentLoaded 触发后执行，也是默认设置项</li> <li>context-menu: 右键菜单项被点击时执行</li></ul> <h3 id="grant"><a href="#grant" class="header-anchor">#</a> @grant</h3> <p>声明 GM_xxx 函数的使用列表	必须先指定权限才能正常使用
由于关闭和聚焦选项卡是一项强大的功能，因此也需要将其添加到 @grant 语句中。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// @grant GM_setValue</span>
<span class="token comment">// @grant GM_getValue</span>
<span class="token comment">// @grant GM_setClipboard</span>
<span class="token comment">// @grant unsafeWindow</span>
<span class="token comment">// @grant window.close</span>
<span class="token comment">// @grant window.focus</span>
<span class="token comment">// @grant window.onurlchange</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>@antifeature脚本是否有广告、挖矿、数据收集等商业行为
@noframes声明脚本不在 iframe 中运行
@unwrap将没有任何包装器和沙箱的用户脚本注入页面，这可能对 Scriptlet 有用。</p> <h2 id="逻辑层"><a href="#逻辑层" class="header-anchor">#</a> 逻辑层</h2> <h3 id="unsafewindow"><a href="#unsafewindow" class="header-anchor">#</a> unsafeWindow</h3> <p>访问页面的 Window 对象</p> <h3 id="subresource-integrity"><a href="#subresource-integrity" class="header-anchor">#</a> Subresource Integrity</h3> <p>资源完整性</p> <h3 id="gm-addstyle-gm-getresourcetext"><a href="#gm-addstyle-gm-getresourcetext" class="header-anchor">#</a> GM_addStyle &amp; GM_getResourceText</h3> <p>GM_addStyle(css)	创建全局样式的快捷方式，向页面插入 style 元素(也可以用 DOM 操作手动创建)
GM_addStyle('#bdshare{display:none !important}')</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//批量加</span>
<span class="token keyword">var</span> ads<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;iframe&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.layout-header&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.layout-footer&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.xuexi&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.WNiH6aSBS23IzewzHGi4v&quot;</span><span class="token punctuation">,</span><span class="token string">'audio'</span><span class="token punctuation">,</span><span class="token string">&quot;.redflag-2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;div[style='background-repeat: no-repeat;']&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.my-points-section .earn-header&quot;</span><span class="token punctuation">,</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">;</span>i<span class="token operator">&lt;</span>ads<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">GM_addStyle</span><span class="token punctuation">(</span>ads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'{display:none}'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">GM_addStyle</span><span class="token punctuation">(</span><span class="token string">&quot;.my-points-card {height:150px !important}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">GM_addStyle</span><span class="token punctuation">(</span><span class="token string">&quot;* {margin-top:0px !important; margin-left:0px !important}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="gm-getresourcetext-name"><a href="#gm-getresourcetext-name" class="header-anchor">#</a> GM_getResourceText(name)</h3> <p>获取 @resource 中已声明的资源</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// @grant        GM_addStyle</span>
<span class="token comment">// @grant        GM_getResourceText</span>
<span class="token comment">// @resource css https://cdn.jsdelivr.net/npm/index.css</span>

<span class="token function">GM_addStyle</span><span class="token punctuation">(</span><span class="token function">GM_getResourceText</span><span class="token punctuation">(</span>css<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">GM_getResourceURL</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token comment">//获取 @resource 中已声明的资源（base64 URI 形式）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="gm-addelement"><a href="#gm-addelement" class="header-anchor">#</a> GM_addElement</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">GM_addElement</span><span class="token punctuation">(</span>tag_name<span class="token punctuation">,</span> attributes<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">GM_addElement</span><span class="token punctuation">(</span>parent_node<span class="token punctuation">,</span> tag_name<span class="token punctuation">,</span> attributes<span class="token punctuation">)</span> 向 <span class="token constant">DOM</span> <span class="token function">新建元素</span><span class="token punctuation">(</span>也可以用 <span class="token constant">DOM</span> 操作手动创建<span class="token punctuation">)</span>
<span class="token function">GM_addElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  textContent<span class="token operator">:</span> <span class="token string">'window.foo = &quot;bar&quot;;'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">GM_addElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  src<span class="token operator">:</span> <span class="token string">'https://example.com/script.js'</span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> <span class="token string">'text/javascript'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">GM_addElement</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'img'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  src<span class="token operator">:</span> <span class="token string">'https://example.com/image.png'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">GM_addElement</span><span class="token punctuation">(</span>shadowDOM<span class="token punctuation">,</span> <span class="token string">'style'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  textContent<span class="token operator">:</span> <span class="token string">'div { color: black; };'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//实验性的功能</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="gm-set-get-deletevalue-gm-listvalues"><a href="#gm-set-get-deletevalue-gm-listvalues" class="header-anchor">#</a> GM_set/get/deleteValue &amp; GM_listValues</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">GM_setValue</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
<span class="token comment">// @grant        GM_setValue</span>
<span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token comment">//存储的数据类似localstorge，但是不是在哪里，保存在插件内部，持久缓存</span>


<span class="token function">GM_getValue</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> defaultValue<span class="token punctuation">)</span>
<span class="token comment">// @grant        GM_getValue</span>
<span class="token function">GM_getValue</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token comment">//18</span>
<span class="token function">GM_getValue</span><span class="token punctuation">(</span><span class="token string">'gg'</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token comment">//99,(获取一个存储体里没有的数据，则用第二个默认值，无则undefined))</span>


<span class="token function">GM_deleteValue</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token comment">// @grant        GM_deleteValue</span>
<span class="token function">GM_deleteValue</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token comment">//18</span>
从存储体中删除数据


<span class="token function">GM_listValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// @grant        GM_listValues</span>
<span class="token function">GM_listValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//返回一个数组，里面的值是存储体的key</span>
列举存储体中所有数据项
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="gm-add-removevaluechangelistener"><a href="#gm-add-removevaluechangelistener" class="header-anchor">#</a> GM_add/removeValueChangeListener</h3> <p>GM_addValueChangeListener(name, function(name, old_value, new_value, remote) {})
向存储添加更改侦听器并返回侦听器 ID。
'name' 是观察到的变量的名称。
回调函数的 'remote' 参数显示此值是从另一个选项卡的实例 (true) 还是在此脚本实例 (false) 中修改的。
因此，不同浏览器选项卡的脚本可以使用此功能相互通信。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">GM_removeValueChangeListener</span><span class="token punctuation">(</span>listener_id<span class="token punctuation">)</span><span class="token comment">//按其 ID 删除更改​​侦听器。</span>
<span class="token comment">// @grant        GM_setValue</span>
<span class="token comment">// @grant        GM_addValueChangeListener</span>
<span class="token comment">// @grant        GM_removeValueChangeListener</span>

<span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span> <span class="token string">'old_value'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> add <span class="token operator">=</span> <span class="token function">GM_addValueChangeListener</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> old_value<span class="token punctuation">,</span> new_value<span class="token punctuation">,</span> remote</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> old_value<span class="token punctuation">,</span> new_value<span class="token punctuation">,</span> remote<span class="token punctuation">)</span> <span class="token comment">//3秒后输出 =&gt;value old_value new_value false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span> <span class="token string">'new_value'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">GM_removeValueChangeListener</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span> <span class="token comment">//按 ID 删除侦听器</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'已删除'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span> <span class="token string">'new_value1'</span><span class="token punctuation">)</span> <span class="token comment">//这里改变'value'的值后侦听器不会再执行</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">6000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="gm-log-message"><a href="#gm-log-message" class="header-anchor">#</a> GM_log(message)</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// @grant        GM_log</span>

<span class="token function">GM_log</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token comment">//相当于console.log</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="gm-reg-unregistermenucommand"><a href="#gm-reg-unregistermenucommand" class="header-anchor">#</a> GM_reg/unregisterMenuCommand</h3> <p>注册/删除一个菜单
GM_registerMenuCommand(name, fn, accessKey)</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">GM_unregisterMenuCommand</span><span class="token punctuation">(</span>menuCmdId<span class="token punctuation">)</span>
<span class="token comment">// @grant        GM_registerMenuCommand</span>
<span class="token comment">// @grant        GM_unregisterMenuCommand</span>

<span class="token keyword">let</span> menu <span class="token operator">=</span> <span class="token function">GM_registerMenuCommand</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span>
    <span class="token function">GM_unregisterMenuCommand</span><span class="token punctuation">(</span>menu<span class="token punctuation">)</span> <span class="token comment">//按id删除一个菜单</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'h'</span><span class="token punctuation">)</span> <span class="token comment">//快捷键</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="gm-openintab-url-options-gm-openintab-url-loadinbackground"><a href="#gm-openintab-url-options-gm-openintab-url-loadinbackground" class="header-anchor">#</a> GM_openInTab(url, options), GM_openInTab(url, loadInBackground)</h3> <ul><li>新开一个 tab 页</li> <li>active 决定是否应该关注新标签，</li> <li>insert 在当前标签之后插入新标签，</li> <li>setParent 使浏览器在关闭时重新聚焦当前选项卡</li> <li>隐身使选项卡在隐身模式/私人模式窗口中打开。</li> <li>否则，只会附加新选项卡。  loadInBackground 与 active 的含义相反，被添加以实现 Greasemonkey 3.x 兼容性。  如果既没有给出 active 也没有给出 loadInBackground，那么标签将不会被聚焦。  此函数返回一个对象，其中包含函数 close、监听器 onclose 和一个名为 closed 的标志。</li></ul> <h3 id="gm-xmlhttprequest-details"><a href="#gm-xmlhttprequest-details" class="header-anchor">#</a> GM_xmlhttpRequest(details)</h3> <ul><li>发送请求</li> <li>method GET, HEAD, POST其中一个</li> <li>url 目标URL</li> <li>headers 例如user-agent, referer等等(Safari和Android浏览器一些特殊的headers是不支持的)</li> <li>data 在post请求的时候发送一些字符串</li> <li>cookie 附加一些额外的cookie到原本的cookie中</li> <li>binary 以二进制模式发送data字符串</li> <li>nocache 不缓存资源</li> <li>revalidate 重新验证缓存资源</li> <li>timeout 超时时间(ms)</li> <li>context 将添加到响应对象的属性</li> <li>responseType 期望的返回类型，通常为arraybuffer, blob, json之一</li> <li>overrideMimeType 指定一个MIME类型用于替代服务器指定的类型</li> <li>anonymous 匿名模式，不随请求发送cooki</li> <li>fetch （测试）使用fetch api代替xhr，在chorme这会导致xhr.abort,details,timeout,xhr.onprogress不工作和导致xhr.onreadystatechange仅接收</li> <li>readyState4事件</li> <li>user 用于身份验证的用户名</li> <li>password 密码</li> <li>onabort 如果请求中止则回调此函数</li> <li>onerror 如果请求发生错误则回调此函数</li> <li>onloadstart如果请求开始加载则回调此函数</li> <li>onprogress 如果请求有了一些新的进度则回调此函数</li> <li>onreadystatechange 如果请求的readyState 发生变化则回调此函数（readyState 是一个无符号的整型数字，代表请求的状态码）</li> <li>ontimeout 如果请求超时则回调此函数</li> <li>onload 如果请求完毕则回调此函数</li> <li>finalUrl -从加载的位置进行重定向后的最终URL</li> <li>readyState - 请求状态码</li> <li>status - 请求响应的状态</li> <li>statusText - 请求状态的文本</li> <li>responseHeaders - 请求返回的heades</li> <li>response - 返回数据作为对象，如果响应类型已经设置</li> <li>responseXML - 返回的数据作为xml</li> <li>responseText - 返回的数据作为纯字符串
返回一个具有abort 函数的对象</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> ajax <span class="token operator">=</span> <span class="token function">GM_xmlhttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token comment">//请求方法 GET POST</span>

  <span class="token comment">/* headers: { //消息头
      &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;
  }, */</span>

  <span class="token comment">// data: '', //通过 POST 请求发送的字符串</span>

  <span class="token comment">// timeout: 10000, //超时（毫秒）</span>

  responseType<span class="token operator">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span> <span class="token comment">//响应的数据类型 text arraybuffer blob document json</span>

  <span class="token comment">// overrideMimeType: &quot;text/xml&quot;, //请求的 MIME 类型</span>

  url<span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>

  <span class="token function-variable function">onabort</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//如果请求中止，则要执行的回调</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onerror</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//如果请求最终出现错误，则要执行的回调</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onloadstart</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//在加载开始时执行的回调，如果 responseType 设置为&quot;stream&quot;，则提供对流对象的访问</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onprogress</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//如果请求取得了一些进展，则要执行的回调</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onreadystatechange</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//在请求的就绪状态发生更改时要执行的回调</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">ontimeout</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//如果请求由于超时而失败，则要执行的回调</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onload</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">xhr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//如果加载了请求，则要执行的回调</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ajax<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//调用以取消此请求</span>

<span class="token function">GM_download</span><span class="token punctuation">(</span>details<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">GM_download</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// @grant        GM_download</span>

<span class="token keyword">let</span> down <span class="token operator">=</span> <span class="token function">GM_download</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token operator">:</span> <span class="token string">'url'</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'文件名'</span><span class="token punctuation">,</span>
  saveAs<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//布尔值，显示&quot;保存为&quot;对话框</span>
  <span class="token function-variable function">onerror</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//如果下载最终出现错误，则要执行的回调</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onprogress</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">pro</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//如果此下载取得了一些进展，则要执行的回调</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pro<span class="token punctuation">.</span>loaded<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pro<span class="token punctuation">.</span>totalSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">ontimeout</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//如果此下载由于超时而失败，则要执行的回调</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onload</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//如果此下载完成，则要执行的回调</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
down<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//调用以取消此下载</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><h3 id="gm-gettab-callback"><a href="#gm-gettab-callback" class="header-anchor">#</a> GM_getTab(callback)</h3> <h3 id="gm-savetab-tab"><a href="#gm-savetab-tab" class="header-anchor">#</a> GM_saveTab(tab)</h3> <h3 id="gm-gettabs-callback"><a href="#gm-gettabs-callback" class="header-anchor">#</a> GM_getTabs(callback)</h3> <h3 id="gm-notification-gm-openintab-gm-setclipboard"><a href="#gm-notification-gm-openintab-gm-setclipboard" class="header-anchor">#</a> GM_notification &amp; GM_openInTab &amp; GM_setClipboard</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// @grant        GM_openInTab</span>
<span class="token comment">// @grant        GM_notification</span>
<span class="token comment">// @grant        GM_setClipboard</span>

<span class="token function">GM_notification</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">&quot;标题&quot;</span><span class="token punctuation">,</span>
    image<span class="token operator">:</span> <span class="token string">&quot;图像链接&quot;</span><span class="token punctuation">,</span>
    text<span class="token operator">:</span> <span class="token string">&quot;通知内容&quot;</span><span class="token punctuation">,</span>
    highlight<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//布尔值，是否突出显示发送通知的选项卡</span>
    silent<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>   <span class="token comment">//布尔值，是否播放声音</span>
    timeout<span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>  <span class="token comment">//设置通知隐藏时间</span>
    <span class="token function-variable function">onclick</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//在单击通知时调用</span>
        <span class="token function">GM_openInTab</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">//使用此 URL打开一个新标签页</span>
        <span class="token comment">//or</span>
        <span class="token function">GM_setClipboard</span><span class="token punctuation">(</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">)</span> <span class="token comment">//将数据复制到剪贴板</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">ondone</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//在通知关闭（无论这是由超时还是单击触发）或突出显示选项卡时调用</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="gm-notification-details-ondone-gm-notification-text-title-image-onclick"><a href="#gm-notification-details-ondone-gm-notification-text-title-image-onclick" class="header-anchor">#</a> GM_notification(details, ondone), GM_notification(text, title, image, onclick)</h3> <h3 id="gm-setclipboard-data-info"><a href="#gm-setclipboard-data-info" class="header-anchor">#</a> GM_setClipboard(data, info)</h3> <h3 id="gm-info"><a href="#gm-info" class="header-anchor">#</a> GM_info</h3> <h2 id="例子"><a href="#例子" class="header-anchor">#</a> 例子</h2> <ul><li>下载图片</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/* globals jQuery, $, waitForKeyElements */</span>
<span class="token comment">/* globals swal */</span>
<span class="token comment">// ==UserScript==</span>
<span class="token comment">// @name         微信下载图片</span>
<span class="token comment">// @namespace    http://tampermonkey.net/</span>
<span class="token comment">// @version      0.1</span>
<span class="token comment">// @description  try to take over the world!</span>
<span class="token comment">// @author       You</span>
<span class="token comment">// @include      https://*</span>
<span class="token comment">// @include      http://*</span>
<span class="token comment">// @icon         https://www.google.com/s2/favicons?sz=64&amp;domain=qq.com</span>
<span class="token comment">// @grant        GM_download</span>
<span class="token comment">// @require      https://www.unpkg.com/jquery@3.5.1/dist/jquery.slim.min.js</span>
<span class="token comment">// @require      https://unpkg.com/sweetalert/dist/sweetalert.min.js</span>
<span class="token comment">// @run-at       context-menu</span>
<span class="token comment">// ==/UserScript==</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token string">'use strict'</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> imgList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> imgList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> src <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>imgList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> dataSrc <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>imgList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>src <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^data:</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">GM_download</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    url<span class="token operator">:</span> src<span class="token punctuation">,</span>
                    name<span class="token operator">:</span> src<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>src<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>dataSrc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">GM_download</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    url<span class="token operator">:</span> dataSrc<span class="token punctuation">,</span>
                    name<span class="token operator">:</span> dataSrc<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>dataSrc<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token parameter">delay <span class="token operator">=</span> <span class="token number">1000</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/my-doc/tags/?tag=%E6%B2%B9%E7%8C%B4" title="标签">#油猴</a></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2022/10/22 下午5:37:02</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/my-doc/pages/5e622c/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">2.使用postman</div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/my-doc/pages/5e622c/">2.使用postman</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/my-doc/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/my-doc/pages/a08de4/"><div>滑动事件</div></a> <span>07-31</span></dt></dl><dl><dd>02</dd> <dt><a href="/my-doc/pages/b06133/"><div>配置preti插件</div></a> <span>07-18</span></dt></dl><dl><dd>03</dd> <dt><a href="/my-doc/pages/989325/"><div>刷题</div></a> <span>07-06</span></dt></dl> <dl><dd></dd> <dt><a href="/my-doc/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/my-doc/assets/js/app.029ead00.js" defer></script><script src="/my-doc/assets/js/2.5123b685.js" defer></script><script src="/my-doc/assets/js/17.0a47cbea.js" defer></script>
  </body>
</html>